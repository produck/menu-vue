/*!
 * @produck/menu-vue v0.1.0
 * (c) 2020-2021 ChaosLee
 * Released under the MIT License.
 */
const t=Object.assign,e=t=>{throw new Error(t)},n=(t,e)=>t instanceof e,i=(t,e)=>typeof t===e,s=t=>Array.isArray(t),o=t=>i(t,"function"),r=t=>i(t,"string"),c=t=>i(t,"boolean"),l=t=>null===t,a=document,u=window,h=a.body,m=DocumentFragment,d=(t,e,n)=>{t.addEventListener(e,n)},p=t=>Array.from(t.childNodes).map((e=>y(t,e))),f=t=>a.createElement(t),b=t=>a.createTextNode(t),g=(t,...e)=>{for(const n of e)for(const e in n)t.style.setProperty(e,n[e])},x=(t,e)=>{t.appendChild(e)},y=(t,e)=>{t.removeChild(e)},$=(t,...e)=>{t.classList.add(...e)},A=(t,...e)=>{t.classList.remove(...e)},k=t=>t.stopPropagation(),w=t=>{(t=>{t.preventDefault()})(t),k(t)},v=t=>t.getBoundingClientRect(),C=()=>a.createDocumentFragment(),_=(E="menu",t=>`var(--${E}-${t})`);var E;const S=/^[a-z0-9`~?]$/i,M=/^([^&]*)(&[a-z]|&&)?([^&]*)$/i,T=(t,e=!1)=>{const n=C(),i={n:n,f:null},[,s,o,r]=t.match(M);if(void 0===o)x(n,b(s));else if("&&"===o)x(n,b([s,"&",r].join("")));else{const t=o[1];if(e)x(n,b([s,t,r].join("")));else{const e=f("u");e.textContent=t,i.f=t.toLowerCase(),x(n,b(s)),x(n,e),x(n,b(r))}}return i};let z=0,F=0;d(u,"mousedown",(t=>{z=t.clientX,F=t.clientY}));const N={display:"block",border:"1px solid transparent"},U={position:"relative",display:"flex"};class D{}class L{constructor(t){n(t,D)||(t=>{throw new Error(t)})("A menu required.");const e=f("li"),i=f("a");x(e,i),g(e,N),g(i,U),$(e,"menu-item"),this.e=e,this.t=i,this.$=t}L(t){d(this.e,"mouseenter",t)}A(){}get 0(){return!1}}const O=t=>{const e={id:null},{id:n=e.id,type:i}=t;return e.id=n,e.type=i,e},j={"margin-right":"0.5em"},B={"flex-grow":"1",padding:`0 ${_("size-lg")}`};class I extends L{constructor(t,e){super(t);const n=this.t,i=f("span");if(!l(e.icon)){const t=f("span");$(t,"menu-item-icon"),g(t,j),x(i,t),x(t,e.icon)}$(i,"menu-item-label"),g(i,B),x(n,i);const s=T(e.label,!t.h);x(i,s.n),this.l=i,this.L((()=>t.F(this))),this.g=s.f}F(){$(this.e,"focus")}r(){const t=this.e;A(t,"focus")}get 0(){return!0}get _(){return!1}}const X=i=>{const s=t({label:"<NO_LABEL>",icon:null},O(i)),{label:o=s.label,icon:c=s.icon}=i;return r(o)||e("A menu item label MUST be a string."),l(c)||n(c,m)||e("A menu item icon MUST be a DocumentFragment."),s.label=o,s.icon=c,s},P={position:"absolute",height:"100%",width:_("size-lg"),"text-align":"center"},R=f("div"),q={top:0,left:0,width:0,height:"100%",display:"block",position:"fixed","font-size":_("size-md")};g(R,q),$(R,"menu-scope"),x(h,R);let H=null;const W=t=>{x(R,t.m),t.O()},Y=()=>{l(H)||(H.X(),H=null,Z=V=null,g(R,{width:0}))},G=()=>{J().N()},J=()=>{let t=H;for(;!l(t.e);)t=t.e.o;return t},K=()=>{const t=J();return!l(t.o)&&(t.o.C(),!0)},Q={ArrowUp:()=>{J().N(null,!0)},ArrowDown:G,ArrowLeft:K,ArrowRight:()=>{const t=J(),e=t.f;e&&e.sm&&(t.E(),G())},Escape:()=>K()||Y(),Enter:()=>{const t=J().f;t&&t.A()}};d(u,"mousedown",Y),d(u,"blur",Y);let V=null,Z=null;const tt=Object.freeze({get expanding(){return V},get expandable(){return Z},get closed(){return l(H)},next(){H&&H.N()}});d(u,"keydown",(t=>{const{key:e}=t;if(H){const n=J();V=!l(H.e),Z=n.f._,e in Q?Q[e](t):S.test(e)&&n.N(e.toLowerCase())&&n.f.A()}}));const et={top:0,left:0},nt={opacity:.4,cursor:"default"};class it extends I{constructor(t,e){super(t,e);const n=this.e,i=this.t,s=f("span"),o=f("span");$(s,"menu-item-accelerator"),$(o,"menu-item-checkbox"),g(s,B,{"text-align":"right"}),g(o,P,et),x(i,s),x(i,o),x(s,(t=>{const e=t.length-1,n=C();return t.forEach(((t,i)=>{x(n,t),i!==e&&x(n,b(" "))})),n})(e.accelerator)),d(n,"mouseup",(()=>this.C())),d(n,"contextmenu",w),this.c=e.click,this.E=t=>"Enter"===t.key&&this.C();(this.d=e.isDisabled)&&(g(this.e,nt),$(n,"disabled")),e.isChecked&&$(n,"checked")}get 0(){return!this.d}F(){this.d||super.F()}r(){this.d||super.r()}C(){this.c(),Y()}A(){this.C()}}const st=()=>console.warn(void 0),ot=[],rt=t=>(s(t)||e("Menu options MUST be an array."),t.map((t=>{s(t)||e("Menu item group options MUST be an array.");const n=t=>(t=>{t.type="type"in t?t.type:it;const n=ot.find((e=>e.t===t.type));return void 0===n&&e("Invalid menu item type."),n.n(t)})(t);return t.reduce(((t,e)=>{const i=o(e)?e().map(n):[n(e)];return t.push(...i),t}),[])}))),ct=(t,e)=>{ot.push({t:t,n:e})},lt={display:"block","border-bottom":`1px solid ${_("mute-front-color")}`,margin:`${_("size-sm")} ${_("size-md")}`};class at extends L{constructor(t){super(t),g(this.t,lt),this.L((()=>t.F()))}}const ut={display:"block",position:"fixed",margin:0,padding:`${_("size-sm")} 0`,"white-space":"nowrap",border:"1px solid transparent","line-height":_("size-lg"),background:_("back-color"),color:_("front-color"),"user-select":"none",opacity:0,transition:`opacity ${_("animation-duration")}`},ht=t=>t[0];class mt extends D{constructor(){super();const t=f("ul");g(t,ut),$(t,"menu"),this.l=[],this.m=t,this.f=null,this.o=null,this.d=null,this.h=!1;d(t,"mouseleave",(()=>this.F())),d(t,"mousedown",k),d(t,"mouseenter",(()=>{let t=this.o;for(;!l(t);)t.$.F(t),t.$.xC(),t=t.$.o}))}get e(){return this.l.filter((t=>n(t,ft))).find((t=>!l(t.o)))||null}F(t=null){this.f&&this.f.r(),!l(t)&&t.F(),this[this.e===t?"xC":"C"](),this.f=t}E(){n(this.f,ft)&&this.f.E()}C(t=500){this.xC();const e=this.e;e&&n(e,ft)&&(this.d=setTimeout((()=>e.C()),t))}xC(){clearTimeout(this.d)}O(){requestAnimationFrame((()=>g(this.m,{opacity:1})))}X(){y(this.m.parentElement,this.m),this.C(0)}A(t){this.l.push(t)}N(t=null,e=!1){const n=this.l.filter(ht);e&&n.reverse();const i=n.findIndex((t=>t===this.f)),s=n.length;for(let e=0;e<s;e++){const o=n[(i+e+1)%s];if(l(t)||o.g===t)return this.F(o),!0}return!1}static S(t,e){const n=rt(t),i=new this,s=C();return i.h=e,n.forEach(((e,n)=>{if(e.forEach((t=>{const e=new t.type(i,t);i.A(e),x(s,e.e)})),n!==t.length-1){const t=new at(i);i.A(t),x(s,t.e)}})),x(i.m,s),i}}const dt={right:0,top:0},pt=(t,e,n=0,i=0)=>{const s=e.bottom,o=e.top-i,r=e.right+n,c=e.left;g(t,{top:`${o}px`,left:`${r}px`});const l=v(t);l.bottom>u.innerHeight&&g(t,{top:s-t.offsetHeight+"px"}),l.right>u.innerWidth&&g(t,{left:c-t.offsetWidth+"px"})};class ft extends I{constructor(t,e){super(t,e);const n=f("span");g(n,P,dt),$(n,"menu-item-expanding"),x(this.t,n),this.sm=e.submenu,this.o=null,this.L((()=>this.$.E()))}E(){if(l(this.o)){const t=mt.S(this.sm,this.$.h),e=v(this.e);t.o=this,this.o=t,W(t),pt(t.m,e,1,7)}}C(){const t=this.o;l(t)||(t.X(),this.o=null)}A(){this.E(),this.o.N()}_(){return!0}}var bt=Object.freeze({__proto__:null,Clickable:it,Spearator:at,Submenu:ft});ct(it,(i=>{const r=t({click:st,isChecked:!1,isDisabled:!1,accelerator:[]},X(i)),{click:l=r.click,isChecked:a=r.isChecked,isDisabled:u=r.isDisabled,accelerator:h=r.accelerator}=i;return o(l)||e("A `.click()` of clickable item MUST be a function."),c(a)||e("A `.isChecked` MUST be a `boolean`."),c(u)||e("A `.isDisabled` MUST be a `boolean`."),s(h)||e("A `.accelerator` MUST be an array of string."),r.accelerator=h.map((t=>(n(t,m)||e("A `.accelerator` MUST be a `DocumentFragement`."),t))),r.click=l,r.isChecked=a,r.isDisabled=u,r})),ct(ft,(e=>{const n=t({submenu:[]},X(e)),{submenu:i=n.submenu}=e;return n.submenu=rt(i),n})),ct(at,(t=>O(t)));const gt=(t={})=>{const n={position:{x:z,y:F},mnemonic:!1,blocking:!1},{position:s=n.position,mnemonic:o=n.mnemonic,blocking:r=n.blocking}=t;if(c(o)||e("A `modifier.mnemonic` MUST be a boolean."),c(r)||e("A `modifier.blocking` MUST be a boolean."),i(s,"object")){const{x:t=n.position.x,y:i=n.position.y}=s;(isNaN(t)||isNaN(i))&&e("Invalid position."),n.position.x=t,n.position.y=i}else e("A `modifier.position` MUST be a boolean.");return n.mnemonic=o,n.blocking=r,n},xt=(t,e)=>{const{position:n,mnemonic:i,blocking:s}=gt(e),o=mt.S(t,i);((t,e=!1)=>{Y(),H=t,e&&g(R,{width:"100%"})})(o,s),W(o),pt(o.m,(t=>({top:t.y,bottom:t.y,left:t.x,right:t.x}))(n))},yt={_:null,$:null,x:!1},$t=()=>!l(yt._)&&!l(yt.$);let At=!1;d(u,"keyup",(t=>{"Alt"===t.key&&(At=!1)}));const kt={Alt:()=>{if(!At){At=!0;const t=yt.$.b;t.length>0&&(l(yt.$.f)?(Y(),yt.x=yt.$.h=!0,yt.$.f=t[0]):wt())}},Enter:()=>{yt.$.a||(yt.$.a=!0,tt.next())},ArrowDown:()=>{yt.$.a||(yt.$.a=!0,tt.next())},ArrowLeft:()=>{yt.x&&(tt.closed||!1===tt.expanding)&&(yt.$.N(null,!0),yt.$.a&&tt.next())},ArrowRight:()=>{yt.x&&(tt.closed||!1===tt.expandable)&&(yt.$.N(),yt.$.a&&tt.next())},Escape:()=>{tt.closed&&(yt.$.a?yt.$.a=!1:yt.$.f&&wt())}},wt=()=>{$t()&&(yt.$.f=null,At=yt.$.a=yt.$.h=yt.x=!1)};d(u,"mousedown",wt),d(u,"mouseup",wt),d(u,"blur",wt),d(u,"keydown",(t=>{if($t()){const e=t.key;e in kt?kt[e]():S.test(e)&&tt.closed&&(yt.$.a||(yt.$.a=!0),yt.$.N(e.toLowerCase())&&tt.next())}}));const vt=()=>{yt.$&&yt._&&(p(yt._),x(yt._,yt.$.e))},Ct={display:"flex",flex:1,"user-select":"none",height:`${_("bar-height")}`,"line-height":`${_("bar-height")}`,"font-size":_("size-md"),color:_("front-color")};class _t{constructor(){const t=f("div");$(t,"menu-bar"),g(t,Ct),this.e=t,this.b=[],d(t,"click",(()=>this.a=!this.a)),d(t,"mousedown",k),d(t,"mouseup",k),d(t,"contextmenu",w),d(t,"mouseleave",(()=>{this.a||(this.f=null)})),this._h=!1,this._a=!1,this._f=null}get h(){return this._h}set h(t){this._h=t,this.b.forEach((t=>t.S())),(t?$:A)(this.e,"has-mnemonic")}get a(){return this._a}set a(t){if(t!==this._a){const e=this.e;t?($(e,"active"),yt.x=!0,this._f&&this._f.O()):(A(e,"active"),Y()),this._a=t}}get f(){return this._f}set f(t){const e=this.f;t!==e&&(l(e)||e.B(),l(t)||(t.F(),this.a&&t.O())),this._f=t}A(t){this.b.push(t)}N(t=null,e=!1){const n=this.b.slice(0);e&&n.reverse();const i=n.findIndex((t=>t===this.f)),s=n.length;for(let e=0;e<s;e++){const o=n[(i+e+1)%s];if(l(t)||o.m===t)return this.f=o,!0}return!1}}const Et={padding:`0 ${_("size-sm")}`};class St{constructor(t,e){this.$=t,this._=e.menu,this.m=null,this.t=e.title;const n=this.o=f("div"),i=this.i=f("div");$(n,"menu-bar-button"),$(i,"menu-bar-button-title"),x(n,i),g(n,Et);d(n,"mouseenter",(()=>this.$.f=this)),this.S()}S(){const t=T(this.t,!this.$.h);p(this.i),x(this.i,t.n),this.m=t.f}F(){$(this.o,"focus")}B(){A(this.o,"focus")}O(){const{left:t,bottom:e}=v(this.o),n=rt(this._());xt(n,{position:{x:t,y:e},mnemonic:this.$.h})}}const Mt=t=>{const n=(s(i=t)||e("A menu bar options MUST be an array."),i.map((t=>{const n={title:"defalut",menu:[]},{title:i=n.title,menu:s=n.menu}=t;return r(i)||e("A menu bar button title MUST be a string."),n.menu=o(s)?s:()=>s,n.title=i,n})));var i;const c=yt.$=new _t,l=C();n.forEach((t=>{const e=new St(c,t);c.A(e),x(l,e.o)})),x(c.e,l),vt()};function Tt(t=[]){if(!Array.isArray(t))throw new Error("An `options` of menu MUST be an array.");return[t.map((t=>{const e={type:at};return null===t?e:(e.label=t.label,e.type=it,Array.isArray(t.submenu)?(e.type=ft,e.submenu=t.submenu,e):(e.click=t.click,e.isChecked=t.isChecked,e.isDisabled=t.isDisabled,e))}))]}function zt(t,e){xt(Tt(t),e)}const Ft=Object.freeze({popup:xt,closeAll:Y,Bar:Object.freeze({mount:t=>{yt._=t,vt()},set:Mt}),Simple:{popup:zt,setMenuBar:function(t){Mt(function(t=[]){if(!Array.isArray(t))throw new Error("An `options` of menu bar MUST be an array.");return t.map((t=>({title:t.title,menu:Tt(t.menu)})))}(t))}}}),Nt=t=>{t.preventDefault(),t.stopPropagation()};function Ut({blocking:t,mnemonic:e}){return{blocking:Boolean(t),mnemonic:Boolean(e)}}var Dt={install(t){t.$pMenu=Ft,t.prototype.$pMenu=Ft,t.directive("p-menu-simple",{bind(t,e){t.addEventListener("contextmenu",(t=>{Nt(t),zt(e.value,Ut(e.modifiers))}))}}),t.directive("p-menu",{bind(t,e){t.addEventListener("contextmenu",(t=>{Nt(t),xt(e.value,Ut(e.modifiers))}))}})},MenuItem:bt};export default Dt;
