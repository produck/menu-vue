/*!
 * @produck/menu-vue v0.1.4
 * (c) 2020-2022 ChaosLee
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self)["menu-vue"]=e()}(this,(function(){"use strict";const t=Object.assign,e=t=>{throw new Error(t)},n=(t,e)=>t instanceof e,i=(t,e)=>typeof t===e,s=t=>Array.isArray(t),o=t=>i(t,"function"),r=t=>i(t,"string"),c=t=>i(t,"boolean"),l=t=>null===t,a=t=>t.toLowerCase(),u=document,h=window,m=u.body,d=DocumentFragment,f=(t,e,n)=>{t.addEventListener(e,n)},p=t=>Array.from(t.childNodes).map((e=>$(t,e))),b=t=>u.createElement(t),g=t=>u.createTextNode(t),x=(t,...e)=>{for(const n of e)for(const e in n)t.style.setProperty(e,n[e])},y=(t,e)=>{t.appendChild(e)},$=(t,e)=>{t.removeChild(e)},A=(t,...e)=>{t.classList.add(...e)},k=(t,...e)=>{t.classList.remove(...e)},w=t=>t.stopPropagation(),v=t=>{(t=>{t.preventDefault()})(t),w(t)},_=t=>t.getBoundingClientRect(),C=()=>u.createDocumentFragment(),E="L",S="A",M={display:"block",border:"1px solid transparent"},T={position:"relative",display:"flex"};class U{}class F{constructor(t){n(t,U)||e("A menu required.");const i=b("li"),s=b("a");y(i,s),x(i,M),x(s,T),A(i,"menu-item"),this.e=i,this.t=s,this.$=t}[E](t){f(this.e,"mouseenter",t)}[S](){}get 0(){return!1}}const N=t=>{const e={id:null},{id:n=e.id,type:i}=t;return e.id=n,e.type=i,e},D="front-color",L="size-sm",z="size-md",O="size-lg",j="bar-height",B=(I="menu",t=>`var(--${I}-${t})`);var I;const X=/^[a-z0-9`~?]$/i,q=/^([^&]*)(&[a-z]|&&)?([^&]*)$/i,P="f",R=(t,e=!1)=>{const n=C(),i={n:n,[P]:null},[,s,o,r]=t.match(q);if(void 0===o)y(n,g(s));else if("&&"===o)y(n,g([s,"&",r].join("")));else{const t=o[1];if(e)y(n,g([s,t,r].join("")));else{const e=b("u");e.textContent=t,i.f=a(t),y(n,g(s)),y(n,e),y(n,g(r))}}return i};let H=0,W=0;f(h,"mousedown",(t=>{H=t.clientX,W=t.clientY}));const Y="F",G="r",J="e",K="xC",Q="N",V="F",Z={"margin-right":"0.5em"},tt={"flex-grow":"1",padding:`0 ${B(O)}`};class et extends F{constructor(t,e){super(t);const n=this.t,i=b("span");if(!l(e.icon)){const t=b("span");A(t,"menu-item-icon"),x(t,Z),y(i,t),y(t,e.icon)}A(i,"menu-item-label"),x(i,tt),y(n,i);const s=R(e.label,!t.h);y(i,s.n),this.l=i,this.L((()=>t.F(this))),this.g=s.f}[Y](){A(this.e,"focus")}[G](){const t=this.e;k(t,"focus")}get 0(){return!0}get _(){return!1}}const nt=i=>{const s=t({label:"<NO_LABEL>",icon:null},N(i)),{label:o=s.label,icon:c=s.icon}=i;return r(o)||e("A menu item label MUST be a string."),l(c)||n(c,d)||e("A menu item icon MUST be a DocumentFragment."),s.label=o,s.icon=c,s},it={position:"absolute",height:"100%",width:B(O),"text-align":"center"},st="C",ot={top:0,left:0},rt={opacity:.4,cursor:"default"},ct=[],lt=t=>{o(t)||e("A listener after click MUST be a function."),ct.push(t)};class at extends et{constructor(t,e){super(t,e);const n=this.e,i=this.t,s=b("span"),o=b("span");A(s,"menu-item-accelerator"),A(o,"menu-item-checkbox"),x(s,tt,{"text-align":"right"}),x(o,it,ot),y(i,s),y(i,o),y(s,(t=>{const e=t.length-1,n=C();return t.forEach(((t,i)=>{y(n,t),i!==e&&y(n,g(" "))})),n})(e.accelerator)),f(n,"mouseup",(()=>this.C())),f(n,"contextmenu",v),this.c=e.click,this.E=t=>"Enter"===t.key&&this.C();(this.d=e.isDisabled)&&(x(this.e,rt),A(n,"disabled")),e.isChecked&&A(n,"checked")}get 0(){return!this.d}[Y](){this.d||super.F()}[G](){this.d||super.r()}[st](){this.c(),ct.forEach((t=>t()))}[S](){this.C()}}const ut=()=>console.warn(void 0),ht=[],mt=t=>(s(t)||e("Menu options MUST be an array."),t.map((t=>{s(t)||e("Menu item group options MUST be an array.");const n=t=>(t=>{t.type="type"in t?t.type:at;const n=ht.find((e=>e.t===t.type));return void 0===n&&e("Invalid menu item type."),n.n(t)})(t);return t.reduce(((t,e)=>{const i=o(e)?e().map(n):[n(e)];return t.push(...i),t}),[])}))),dt=(t,e)=>{ht.push({t:t,n:e})},ft={display:"block","border-bottom":`1px solid ${B("mute-front-color")}`,margin:`${B(L)} ${B(z)}`};class pt extends F{constructor(t){super(t),x(this.t,ft),this.L((()=>t.F()))}}const bt=b("div"),gt={top:0,left:0,width:0,height:"100%",display:"block",position:"fixed","font-size":B(z)};x(bt,gt),A(bt,"menu-scope");let xt=null;const yt=t=>{y(bt,t.m),t.O()},$t=()=>{l(xt)||(xt.X(),xt=null,x(bt,{width:0}))},At=()=>{kt().N()},kt=()=>{let t=xt;for(;!l(t.e);)t=t.e.o;return t},wt=()=>{const t=kt();return!l(t.o)&&(t.o.C(),!0)},vt={ArrowUp:()=>{kt().N(null,!0)},ArrowDown:At,ArrowLeft:wt,ArrowRight:()=>{const t=kt(),e=t.f;e&&e.sm&&(t.E(),At())},Escape:()=>wt()||$t(),Enter:()=>{const t=kt().f;t&&t.A()}},_t=Object.freeze({get expanding(){return!l(xt.e)},get expandable(){const t=kt();return!!t.f&&t.f._},get closed(){return l(xt)},next(){xt&&xt.N()}});let Ct=!1;const Et={display:"block",position:"fixed",margin:0,padding:`${B(L)} 0`,"white-space":"nowrap",border:"1px solid transparent","line-height":B(O),background:B("back-color"),color:B(D),"user-select":"none",opacity:0,transition:`opacity ${B("animation-duration")}`},St=t=>t[0];class Mt extends U{constructor(){super();const t=b("ul");x(t,Et),A(t,"menu"),this.l=[],this.m=t,this.f=null,this.o=null,this.d=null,this.h=!1;f(t,"mouseleave",(()=>this.F())),f(t,"mousedown",w),f(t,"mouseenter",(()=>{let t=this.o;for(;!l(t);)t.$.F(t),t.$.xC(),t=t.$.o}))}get[J](){return this.l.filter((t=>n(t,Ft))).find((t=>!l(t.o)))||null}[V](t=null){this.f&&this.f.r(),!l(t)&&t.F(),this[this.e===t?K:"C"](),this.f=t}E(){n(this.f,Ft)&&this.f.E()}C(t=500){this.xC();const e=this.e;e&&n(e,Ft)&&(this.d=setTimeout((()=>e.C()),t))}[K](){clearTimeout(this.d)}O(){requestAnimationFrame((()=>x(this.m,{opacity:1})))}X(){$(this.m.parentElement,this.m),this.C(0)}A(t){this.l.push(t)}[Q](t=null,e=!1){const n=this.l.filter(St);e&&n.reverse();const i=n.findIndex((t=>t===this.f)),s=n.length;for(let e=0;e<s;e++){const o=n[(i+e+1)%s];if(l(t)||o.g===t)return this.F(o),!0}return!1}static S(t,e){const n=mt(t),i=new this,s=C();return i.h=e,n.forEach(((e,n)=>{if(e.forEach((t=>{const e=new t.type(i,t);i.A(e),y(s,e.e)})),n!==t.length-1){const t=new pt(i);i.A(t),y(s,t.e)}})),y(i.m,s),i}}const Tt={right:0,top:0},Ut=(t,e,n=0,i=0)=>{const s=e.bottom,o=e.top-i,r=e.right+n,c=e.left;x(t,{top:`${o}px`,left:`${r}px`});const l=_(t);l.bottom>h.innerHeight&&x(t,{top:s-t.offsetHeight+"px"}),l.right>h.innerWidth&&x(t,{left:c-t.offsetWidth+"px"})};class Ft extends et{constructor(t,e){super(t,e);const n=b("span");x(n,it,Tt),A(n,"menu-item-expanding"),y(this.t,n),this.sm=e.submenu,this.o=null,this.L((()=>this.$.E()))}E(){if(l(this.o)){const t=Mt.S(this.sm,this.$.h),e=_(this.e);t.o=this,this.o=t,yt(t),Ut(t.m,e,1,7)}}C(){const t=this.o;l(t)||(t.X(),this.o=null)}[S](){this.E(),this.o.N()}_(){return!0}}var Nt=Object.freeze({__proto__:null,Clickable:at,Spearator:pt,Submenu:Ft});lt($t),dt(at,(i=>{const r=t({click:ut,isChecked:!1,isDisabled:!1,accelerator:[]},nt(i)),{click:l=r.click,isChecked:a=r.isChecked,isDisabled:u=r.isDisabled,accelerator:h=r.accelerator}=i;return o(l)||e("A `.click()` of clickable item MUST be a function."),c(a)||e("A `.isChecked` MUST be a `boolean`."),c(u)||e("A `.isDisabled` MUST be a `boolean`."),s(h)||e("A `.accelerator` MUST be an array of string."),r.accelerator=h.map((t=>(n(t,d)||e("A `.accelerator` MUST be a `DocumentFragement`."),t))),r.click=l,r.isChecked=a,r.isDisabled=u,r})),dt(Ft,(e=>{const n=t({submenu:[]},nt(e)),{submenu:i=n.submenu}=e;return n.submenu=mt(i),n})),dt(pt,(t=>N(t)));const Dt=(t={})=>{const n={position:{x:H,y:W},mnemonic:!1,blocking:!1},{position:s=n.position,mnemonic:o=n.mnemonic,blocking:r=n.blocking}=t;if(c(o)||e("A `modifier.mnemonic` MUST be a boolean."),c(r)||e("A `modifier.blocking` MUST be a boolean."),i(s,"object")){const{x:t=n.position.x,y:i=n.position.y}=s;(isNaN(t)||isNaN(i))&&e("Invalid position."),n.position.x=t,n.position.y=i}else e("A `modifier.position` MUST be a boolean.");return n.mnemonic=o,n.blocking=r,n},Lt=(t,e)=>{const{position:n,mnemonic:i,blocking:s}=Dt(e),o=Mt.S(t,i);((t,e=!1)=>{$t(),xt=t,e&&x(bt,{width:"100%"})})(o,s),yt(o),Ut(o.m,(t=>({top:t.y,bottom:t.y,left:t.x,right:t.x}))(n))},zt="a",Ot="h",jt="f",Bt="N",It="_",Xt="$",qt="x",Pt={[It]:null,[Xt]:null,[qt]:!1},Rt=()=>!l(Pt._)&&!l(Pt.$),Ht=()=>{Pt.x&&!Pt.$.a&&requestAnimationFrame((()=>{Pt.$.a=!0,_t.next()}))};let Wt=!1;const Yt={Alt:()=>{if(!Wt){Wt=!0;const t=Pt.$.b;t.length>0&&(l(Pt.$.f)?($t(),Pt.x=Pt.$.h=!0,Pt.$.f=t[0]):Gt())}},Enter:Ht,ArrowDown:Ht,ArrowLeft:()=>{Pt.x&&(_t.closed||!1===_t.expanding)&&(Pt.$.N(null,!0),Pt.$.a&&_t.next())},ArrowRight:()=>{Pt.x&&(_t.closed||!1===_t.expandable)&&(Pt.$.N(),Pt.$.a&&_t.next())},Escape:()=>{Pt.x&&(Pt.$.a?Pt.$.a=!1:Pt.$.f&&Gt())}},Gt=()=>{Rt()&&(Pt.$.f=null,Wt=Pt.$.a=Pt.$.h=Pt.x=!1)},Jt=()=>{Pt.$&&Pt._&&(p(Pt._),y(Pt._,Pt.$.e))};let Kt=!1;const Qt={display:"flex",flex:1,"user-select":"none",height:`${B(j)}`,"line-height":`${B(j)}`,"font-size":B(z),color:B(D)};class Vt{constructor(){const t=b("div");A(t,"menu-bar"),x(t,Qt),this.e=t,this.b=[],f(t,"click",(()=>this.a=!this.a)),f(t,"mousedown",w),f(t,"mouseup",w),f(t,"contextmenu",v),f(t,"mouseleave",(()=>{this.a||(this.f=null)})),this._h=!1,this._a=!1,this._f=null}get[Ot](){return this._h}set[Ot](t){this._h=t,this.b.forEach((t=>t.S())),(t?A:k)(this.e,"has-mnemonic")}get[zt](){return this._a}set[zt](t){if(t!==this._a){const e=this.e;t?(A(e,"active"),console.log(1111),Pt.x=!0,this._f&&this._f.O()):(k(e,"active"),$t()),this._a=t}}get[jt](){return this._f}set[jt](t){const e=this.f;t!==e&&(l(e)||e.B(),l(t)||(t.F(),this.a&&t.O())),this._f=t}A(t){this.b.push(t)}[Bt](t=null,e=!1){const n=this.b.slice(0);e&&n.reverse();const i=n.findIndex((t=>t===this.f)),s=n.length;for(let e=0;e<s;e++){const o=n[(i+e+1)%s];if(l(t)||o.m===t)return this.f=o,!0}return!1}}const Zt={padding:`0 ${B(L)}`};class te{constructor(t,e){this.$=t,this._=e.menu,this.m=null,this.t=e.title;const n=this.o=b("div"),i=this.i=b("div");A(n,"menu-bar-button"),A(i,"menu-bar-button-title"),y(n,i),x(n,Zt);f(n,"mouseenter",(()=>this.$.f=this)),this.S()}S(){const t=R(this.t,!this.$.h);p(this.i),y(this.i,t.n),this.m=t.f}F(){A(this.o,"focus")}B(){k(this.o,"focus")}O(){const{left:t,bottom:e}=_(this.o),n=mt(this._());Lt(n,{position:{x:t,y:e},mnemonic:this.$.h})}}const ee=t=>{const n=(s(i=t)||e("A menu bar options MUST be an array."),i.map((t=>{const n={title:"defalut",menu:[]},{title:i=n.title,menu:s=n.menu}=t;return r(i)||e("A menu bar button title MUST be a string."),n.menu=o(s)?s:()=>s,n.title=i,n})));var i;const c=Pt.$=new Vt,l=C();n.forEach((t=>{const e=new te(c,t);c.A(e),y(l,e.o)})),y(c.e,l),Jt()};function ne(t=[]){if(!Array.isArray(t))throw new Error("An `options` of menu MUST be an array.");return[t.map((t=>{const e={type:pt};return null===t?e:(e.label=t.label,e.type=at,Array.isArray(t.submenu)?(e.type=Ft,e.submenu=t.submenu,e):(e.click=t.click,e.isChecked=t.isChecked,e.isDisabled=t.isDisabled,e))}))]}function ie(t,e){Lt(ne(t),e)}const se=Object.freeze({popup:Lt,closeAll:$t,Bar:Object.freeze({mount:t=>{Pt._=t,Jt()},set:ee}),Simple:{popup:ie,setMenuBar:function(t){ee(function(t=[]){if(!Array.isArray(t))throw new Error("An `options` of menu bar MUST be an array.");return t.map((t=>({title:t.title,menu:ne(t.menu)})))}(t))}}}),oe=t=>{t.preventDefault(),t.stopPropagation()};function re({blocking:t,mnemonic:e}){return{blocking:Boolean(t),mnemonic:Boolean(e)}}var ce={install(t){t.$pMenu=se,t.prototype.$pMenu=se,t.directive("p-menu-simple",{bind(t,e){t.addEventListener("contextmenu",(t=>{oe(t),ie(e.value,re(e.modifiers))}))}}),t.directive("p-menu",{bind(t,e){t.addEventListener("contextmenu",(t=>{oe(t),Lt(e.value,re(e.modifiers))}))}})},MenuItem:Nt};return Kt||(f(h,"mousedown",Gt),f(h,"blur",Gt),f(h,"keydown",(t=>{if(Rt()){const e=t.key;e in Yt?Yt[e]():X.test(e)&&_t.closed&&Pt.x&&(Pt.$.a||(Pt.$.a=!0),Pt.$.N(a(e))&&_t.next())}})),f(h,"keyup",(t=>{"Alt"===t.key&&(Wt=!1)})),Ct||(y(m,bt),f(h,"mousedown",$t),f(h,"blur",$t),f(h,"keydown",(t=>{const{key:e}=t;if(xt){const n=kt();e in vt?vt[e](t):X.test(e)&&n.N(a(e))&&n.f.A()}})),Ct=!0),lt((()=>Gt())),Kt=!0),ce}));
